{"version":3,"file":"static/chunks/5383.7af5ebcd0fb80bd7.js","mappings":"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","sources":["webpack://_N_E/./src/components/EmailOctopusForm.tsx"],"sourcesContent":["// src/components/EmailOctopusForm.tsx\n'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { useAnalytics } from '@/components/Analytics';\n\ninterface EmailOctopusFormProps {\n  formId: string;\n  className?: string;\n  variant?: 'main' | 'blog';\n  showTitle?: boolean;\n}\n\nexport default function EmailOctopusForm({ \n  formId,\n  className = '',\n  variant = 'main',\n  showTitle = true\n}: EmailOctopusFormProps) {\n\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const loadedRef = useRef(false);\n  const scriptRef = useRef<HTMLScriptElement | null>(null);\n  const { trackEvent } = useAnalytics();\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const loadFormScript = () => {\n      if (loadedRef.current) return;\n      loadedRef.current = true;\n\n      const container = containerRef.current;\n      if (!container) return;\n\n      // Clear any existing content to prevent duplicates\n      container.innerHTML = '';\n\n      // Create and inject the EmailOctopus script\n      const script = document.createElement('script');\n      script.src = `https://eocampaign1.com/form/${formId}.js`;\n      script.async = true;\n      script.setAttribute('data-form', formId);\n      script.onerror = () => {\n        console.warn('EmailOctopus script failed to load - this can be expected in build/test environments');\n      };\n      container.appendChild(script);\n      scriptRef.current = script;\n\n      // Cleanup observers/listeners after load\n      cleanup();\n\n      // Set up MutationObserver to detect success message injection\n      const observer = new MutationObserver((mutations) => {\n        for (const m of mutations) {\n          for (const node of Array.from(m.addedNodes)) {\n            if (!(node instanceof HTMLElement)) continue;\n            const success =\n              node.closest?.('.emailoctopus-success-message') ||\n              node.querySelector?.('.emailoctopus-success-message') ||\n              node.classList?.contains('emailoctopus-success-message');\n            if (success) {\n              trackEvent('newsletter_signup_success', { provider: 'emailoctopus', form_id: formId, variant });\n              observer.disconnect();\n              return;\n            }\n          }\n        }\n      });\n      observer.observe(container, { childList: true, subtree: true });\n\n      // Attempt to attach submit tracking when form appears\n      const attachSubmit = () => {\n        const formEl = container.querySelector('form');\n        if (formEl) {\n          formEl.addEventListener('submit', () => {\n            trackEvent('newsletter_submit', { provider: 'emailoctopus', form_id: formId, variant });\n          }, { once: true });\n          return true;\n        }\n        return false;\n      };\n\n      // Try immediately and again after small delay (script might render async)\n      if (!attachSubmit()) {\n        setTimeout(attachSubmit, 1500);\n      }\n    };\n\n    // IntersectionObserver: load when visible\n    let observer: IntersectionObserver | null = null;\n    const observeVisibility = () => {\n      if (!containerRef.current || loadedRef.current) return;\n      observer = new IntersectionObserver((entries) => {\n        for (const entry of entries) {\n          if (entry.isIntersecting) {\n            loadFormScript();\n            break;\n          }\n        }\n      }, { rootMargin: '200px 0px' });\n      observer.observe(containerRef.current);\n    };\n\n    // Interaction fallback: first scroll/click/touch\n    const onInteract = () => loadFormScript();\n\n    const addInteractionListeners = () => {\n      if (loadedRef.current) return;\n      window.addEventListener('scroll', onInteract, { passive: true, once: true });\n      window.addEventListener('click', onInteract, { once: true });\n      window.addEventListener('touchstart', onInteract, { passive: true, once: true });\n      // Idle fallback in case neither visibility nor interaction happens soon\n      const idle = (cb: () => void) =>\n        ('requestIdleCallback' in window ? (window as any).requestIdleCallback(cb, { timeout: 4000 }) : setTimeout(cb, 3000));\n      idle(() => loadFormScript());\n    };\n\n    const cleanup = () => {\n      if (observer && containerRef.current) {\n        try { observer.unobserve(containerRef.current); } catch {}\n      }\n      observer?.disconnect();\n      window.removeEventListener('scroll', onInteract as any);\n      window.removeEventListener('click', onInteract as any);\n      window.removeEventListener('touchstart', onInteract as any);\n    };\n\n    observeVisibility();\n    addInteractionListeners();\n\n    return () => {\n      cleanup();\n      // Remove injected script node for safety (form markup remains)\n      const container = containerRef.current;\n      const script = scriptRef.current;\n      if (container && script && script.parentNode === container) {\n        container.removeChild(script);\n      }\n    };\n  }, [formId]);\n\n  const copy = variant === 'blog' ? {\n    title: 'Join The Looking Glass',\n    subtitle: 'Weekly insights on digital consciousness and creative technology.'\n  } : {\n    title: 'Subscribe to Our Newsletter',\n    subtitle: 'Strategic intelligence on digital transformation and innovation.'\n  };\n\n  return (\n    <div className={`email-octopus-form ${className}`}>\n      {showTitle && (\n        <div className=\"text-center mb-6\">\n          <h3 className=\"text-2xl font-display font-bold text-text-primary mb-3\">\n            {copy.title}\n          </h3>\n          <p className=\"text-text-secondary\">\n            {copy.subtitle}\n          </p>\n        </div>\n      )}\n\n      {/* Container for the EmailOctopus script */}\n      <div ref={containerRef} className=\"emailoctopus-script-container\" />\n\n      {/* Privacy notice */}\n      <p className=\"mt-4 text-xs text-text-muted text-center\">\n        We respect your privacy. Unsubscribe at any time.\n        {' '}\n        <a href=\"/privacy\" className=\"text-accent-burgundy hover:text-accent-highlight underline\">\n          Privacy Policy\n        </a>\n      </p>\n    </div>\n  );\n}"],"names":["EmailOctopusForm","param","formId","className","variant","showTitle","containerRef","useRef","loadedRef","scriptRef","trackEvent","useAnalytics","useEffect","cb","loadFormScript","current","container","innerHTML","script","document","createElement","src","concat","async","setAttribute","onerror","console","warn","appendChild","cleanup","observer","MutationObserver","m","mutations","node","Array","from","addedNodes","HTMLElement","closest","querySelector","classList","contains","provider","form_id","disconnect","observe","childList","subtree","attachSubmit","formEl","addEventListener","once","setTimeout","onInteract","unobserve","e","window","removeEventListener","IntersectionObserver","entry","entries","isIntersecting","rootMargin","passive","requestIdleCallback","timeout","parentNode","removeChild","copy","title","subtitle","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","div","jsx","h3","p","ref","a","href"],"sourceRoot":""}